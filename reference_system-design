# Roocode 業務遂行システム 全体像（ドラフト）

## 1. 目的と思想

本システムは、Roocode を用いて以下を実現することを目的とする。

- ユーザー（人間）を起点とした業務遂行
- 判断責任の所在を明確に保ったままの自動化
- LLM のコンテキスト制限を前提とした、長期・反復運用
- Mode を増やしすぎない、保守可能な構成

基本思想は以下の通り。

- **ユーザーは常に1つの Mode（pmMode）とだけ対話する**
- **判断権と責任は pmMode に集約する**
- **他の Mode は専門作業員であり、判断主体ではない**
- **知識は内包せず、参照する**
- **要約を第一級成果物とする**

---

## 2. 全体アーキテクチャ概要

### 2.1 論理構造

User ⇅ pmMode（唯一の対話窓口・最終責任者） ├─ Skill（思考・設計・分析） ├─ Orchestrator（内部制御） │   ├─ Code Mode │   ├─ Writer Mode │   ├─ Reviewer Mode │   ├─ QA Mode │   └─ Publisher Mode └─ 外部ドキュメント・成果物（参照）

- User は pmMode 以外の存在を意識しない
- Orchestrator は pmMode の内部機構として扱う
- Mode は「役職」、Skill は「手続き」

---

## 3. Mode 設計方針

### 3.1 pmMode（必須・中核）

**役割**
- ユーザー意図の理解
- タスク分解
- 判断・優先順位付け
- Skill / Mode の選択
- 成果物の統合
- エスカレーション判断
- 最終報告

**原則**
- 判断責任を手放さない
- 不確実性があれば必ずユーザーに戻す
- 自律ループは裁量範囲内のみ許可

---

### 3.2 作業系 Mode（判断しない）

| Mode | 主な責務 |
|----|----|
| Code | 実装・コード生成 |
| Writer | 文書化・説明文生成 |
| Reviewer | 構造・論理レビュー |
| QA | 要件充足・品質確認 |
| Publisher | 公開・配置・通知 |

※ いずれも「与えられた指示を実行する」立場  
※ 方針変更や判断が必要な場合は pmMode に差し戻す

---

### 3.3 Mode にしない役割

以下は **Mode ではなく Skill として扱う**。

- Architect（技術設計）
- Researcher（調査）
- Planner（計画立案）

理由：
- 判断権を持たせないため
- pmMode の思考プロセスとして内包するため

---

## 4. Skill 設計方針

### 4.1 Skill の位置づけ

- 再利用可能な思考・作業単位
- 状態を持たない
- 単発実行が前提

### 4.2 想定される Skill カテゴリ

- 思考系
  - タスク分解
  - ワークフロー設計
  - トレードオフ整理
- 設計系
  - アーキテクチャ設計
  - 非機能要件整理
- 調査系
  - 技術調査
  - 比較表作成
- 運用系
  - 成果物要約
  - 状態更新

---

## 5. コンテキスト管理の全体像

### 5.1 コンテキスト階層

Layer 1: pmMode 常駐（小・不変） Layer 2: プロジェクト状態（要約・可変） Layer 3: 成果物・資料（全文・参照）

### 5.2 各レイヤの役割

- Layer 1  
  - 判断原則
  - 思考フロー
  - 裁量・責任範囲

- Layer 2  
  - 現在の状態
  - 決定事項の要約
  - 未解決課題

- Layer 3  
  - 設計書
  - コード
  - ドキュメント

---

## 6. 実運用までに決めるべきこと（棚卸し）

### 6.1 ガバナンス・思想

- pmMode の裁量範囲
- エスカレーション条件
- ユーザー介入が必須な判断の定義
- 自律ループの許可条件

---

### 6.2 Mode 設計

- 採用する Mode の確定
- 各 Mode の責務境界
- Mode 間の差し戻しルール

---

### 6.3 Skill 設計

- 必須 Skill の洗い出し
- Skill の粒度基準
- Skill の入出力フォーマット

---

### 6.4 コンテキスト管理

- pmMode 常駐コンテキストの最小セット
- project_state の構造
- 要約のフォーマットと更新ルール

---

### 6.5 成果物管理

- 成果物の保存先
- サマリーの必須化ルール
- バージョン管理方針

---

### 6.6 Publisher 方針

- 公開先の種類
- 公開可否判断基準
- 通知ルール（Teams / GitHub 等）

---

### 6.7 フェイルセーフ

- 判断不能時の挙動
- コンテキスト不足時の対応
- エラー時のユーザー通知方針

---

## 7. 段階的詳細化の進め方（推奨）

1. 全体思想・責任分界の固定
2. Mode 構成の確定
3. pmMode の常駐コンテキスト定義
4. project_state の雛形作成
5. Skill の優先順位付け
6. 小さな業務で試験運用
7. ルールの微調整

---

## 8. 本設計のゴール

- pmMode が「迷わず判断できる」
- ユーザーが「常に状況を把握できる」
- LLM の制約下でも破綻しない
- 人間の組織設計と整合する